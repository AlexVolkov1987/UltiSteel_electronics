# Модуль управления и мониторинга питания принтера

## Описание

### Функции:

- Включение принтера с помощью тактовой кнопки включение
- Выключение принтера по команде с платы управления принтера
- Выключение принтера с помощью тактовой кнопки включения
- Аварийное отключение принтера по команде с платы управления принтера
- Аварийное отключение принтера с помощью внешней кнопки
- Аварийное отключение принтера по КЗ или потере напряжения в линии питания 12/24В

### Разъемы:

- 220_IN - высоковольтный вход модуля. Должен всегда находиться под напряжением
- 220_OUT - управляемый выход модуля. К нему подключается высоковольтный вход блока питания принтера
- POWER_BUTTON - тактовая кнопка для включения/выключения модуля
- POWER_LED - индикация наличия питания на выходе блока питания принтера.
- STATUS_LED - индикация состояния принтера  
- EM_STOP - тактовая кнопка аварийной остановки. Должна быть нормально замкнутой. В случае отсутствия кнопки, для нормальной работы модуля необходимо установить перемычку EM_INT.
- 12/24 V_IN - мониторинг низковольтного выхода блока питания принтера
- CMD_IN - вход управления модулем от управляющей платы принтера.
- CMD_OUT - выход модуля для передачи информации на управляющую плату принтера

### Описание работы:

#### Установка

Установка модуля производится согласно схеме подключения ниже:

Если установка модуля выполнена корректно, то при подаче питания 220В модуль выдаст два коротких звуковых сигнала и включит индикатор STATUS_LED на 5 секунд. В дальнейшем индикатор STATUS_LED будет включаться на 1 секунду каждые 10с в качестве признака состояния сна модуля.

#### Первое включение (по нажатию тактовой кнопки POWER_BUTTON)

Включение модуля производится удержанием тактовой кнопки включения в течение 3-4с.  Модуль выдаст короткий звуковой сигнал и напряжение 220В будет подано на вход блока питания принтера. После этого индикатор STATUS_LED начнет мигать 1 раз в секунду. Таким образом, модуль перешел из состояния сна с состояние ожидания.

В течение минуты после подачи питания управляющая плата принтера должна подать напряжение на разъем модуля CMD_IN. Если этого не произойдет - модуль отключит подачу питания на вход блока питания принтера, выдаст три звуковых сигнала и перейдет из состояния ожидания в состояние сна.

При появлении напряжения на разъеме CMD_IN во время нахождения модуля в состоянии ожидания модуль выдаст один короткий звуковой сигнал, а индикатор  STATUS_LED будет светиться непрерывно. Модуль при этом перейдет в состояние активности.

! В процессе включения и выключения, а так же работы индикатор POWER_LED может включаться и выключаться с запаздыванием, поскольку он отображает наличие напряжения на выходе блока питания принтера и никак не управляется модулем.

#### Выключение (по нажатию кнопки POWER_BUTTON)

 При кратковременном нажатии кнопки POWER_BUTTON модуль управления питанием активирует выход CMD_OUT. Прошивка материнской платы должна использовать этот факт как выполнение последовательности команд по остановке печати, охлаждению хотэнда и снятию сигнала активности с входа CMD_IN.

Если плата снимает напряжение с входа CMD_IN, модуль выдаст двойной короткий звуковой сигнал и через 10с снимет напряжение с блока питания принтера, перейдя в состояние сна.

#### Выключение (по удержанию кнопки POWER_BUTTON)

При удержании кнопки POWER_BUTTON в течение 5-6с модуль снимает напряжение с блока питания принтера и переходит в состояние сна

#### Выключение по команде M81

Управляющая плата при выполнении команды M81 должна снять напряжение с входа CMD_IN модуля. Реакция модуля будет такой же как в варианте выключения по нажатию кнопки POWER_BUTTON.

#### Аварийное выключение по размыканию кнопки EM_STOP

При размыкании кнопки EM_STOP модуль немедленно снимает питание с блока питания принтера. Индикатор STATUS_LED при этом мигает с частотой 3 раза в секунду.

Также блокируется включение принтера по нажатию кнопки POWER_BUTTON. Для снятия блокировки необходимо замкнуть контакты кнопки  EM_STOP. Модуль при этом перейдет в состояние сна.

#### Аварийное выключение по потере напряжения 12/24В

Если в режиме активности на вход 12/24 V_IN не поступает напряжение с блока питания принтера (КЗ или выход из строя блока питания принтера), модуль немедленно снимает напряжение с входа блока питания принтера и выдает три длинных звуковых сигнала.  Индикатор STATUS_LED при этом мигает с частотой 3 раза в секунду.

Также блокируется включение принтера по нажатию кнопки POWER_BUTTON. Для снятия блокировки необходимо полностью обесточить модуль на 30-60сек.

### Список основных компонентов:

- ATMEGA164PA-AUR - микроконтроллер

- G5LE-14-DC5 - силовое реле

- LTV-817A - опторазвязка

- DG126-5.0-03P-14-00AH - клеммник

- IRM-03-5 - изолированный источник питания